# 유지보수하기 쉬운 백엔드 코드

- 백엔드 코딩 개념원리

- 세션: 잭슨
  - 현) 두나무
  - 전) 카카오뱅크 등
  - 주로 자바 스프링 백엔드 개발
    - 다수의 프로젝트에서 스프링 시큐리티 사용
    - OAuth를 많이 사용중



## 비즈니스 로직 개발의 시작

### 비즈니스 로직 개발을 시작하며 고민해야 하는 것들

- 필요한 객체를 식별하고 OOP 원칙에 따라 모델링
- 객체 모델링 방법
  -  객체 모델을 불변 상태로 만들며 시작
  - 객체 모델에 필요한 행동이 무엇인지 고민하고 점진적으로 불변 필드를 줄임
    - `final` 하지 않아야 할 필드 / `final` 필드 구별
      - 변할 수 있는 필드는 Getter에서 `Optional`로 반환
    - `final` 필드는 무조건 세팅, 그 외 필드는 생성자 체이닝
  - equals, hashCode, toString 구현을 꼼꼼히 함
    - 롬복은 사용하지 말라!
      - 제대로 알고 써야 한다.
      - 학습하는 입장에선 직접 구현해보면서 안티패턴에 대한 식별 등을 숙련하는 것이 좋음
      - 자바를 쓰는데 굳이 롬복을 쓸 상황이면 요즘엔 코틀린 씀
  - 불필요한 생성자를 노출시키지 않음
  - 매개변수가 많다면 빌더를 고려
- 가능한 모든 사용자 입력은 유효성 검사를 수행
  - 모든 매개변수를 받는 생성자에서, 생성자 체이닝 이용하여
  - 생성자에서 불변식 검사를 수행하고, mutator 제공하지 않는다면, 그 필드에 대해서 방어적 코드 작성을 줄일 수 있음
- 가능한 Service의 모든 메서드를 테스트



## 입력값 검증

- 자바에는 널리 쓰이는 라이브러리들이 있음

  - guava
    - 입력값 검증의 경우 Preconditions의 `checkArgument`, `checkNull`등 사용해서 검증도 가능
  - apache.commons.lang
  - Hibernate Validator
    - JSR-303, JSR-349, JSR-380 라이브러리
  - 기능 구현 전에 라이브러리를 찾아봐도 좋다.

- 원칙적으로야 각 계층마다 입력값 검증을 해줘야 하지만

  - Controller에서만 검증하는 경우가 많음
  - 그러나 내가 보기에 중요성 순서는 생성자 > 서비스 > 컨트롤러 순이라고 생각한다.
    - Controller 레이어에는 GraphQL, RPC등 다양한 인터페이스가 있을 수 있음
    - 그것들이 같이 바라보는 서비스에 검증 로직이 있는 것이 좋음
    - 서비스끼리 상호 의존이 있을 경우 컨트롤러의 검증 로직을 우회해버린다.
    - **가장 좋은 것은 생성자에서 검증하는 것!**
      - 모델은 모든 레이어를 통과하며 사용됨
      - 개발자에 의해 쉽게 인스턴스화되고 사용되기 때문

  

## Optional, Stram API, Lambda

- `Optional`
  - NPE는 가장 흔한 런타임 예외 중 하나
  - NPE 방어를 위한 `null` 체크 로직은 코드 가독성과 유지보수성을 떨어트림
  - 대신 `Optional`을 활용하자
    - 값이 `null`일 수 있다는 명시적 표현
    - `map()`, `filter()` 같은 메서드로 `Optional`이 포함하고 있는 값에 대해 연산 처리
    - 특히 `orElse`, `orElseGet`의 차이점도 이해하고 있어야 함
- Stream API, Lambda
  - Stream API는 Java Collection에 대해 다양한 연산을 지원
  - 람다: 자바의 람다는 다소 제한적으로 지원되는 함수형 프로그래밍
    - 일급 객체(First-Citizen)을 지원하지 않기에 람다 사용이 제한적
      - 일급 객체
        - 변수에 할당
        - 함수에 인자 전달
        - 함수 결과로 리턴
      - 함수를 파라미터로 넘길 수 없음
    - 함수형 인터페이스는는 람다로 표현 가능
  - 코드를 간결하게 만들 수 있음
    - 개발자의 의도가 명확해지고, 가독성이 향상됨
    - parallelstream 사용하면 병렬처리가 편해짐(단, 조심해야 할 것이 많음)



## 예외 처리

- 검사 vs 비검사 예외
  - 최근에는 `RuntimeException`이 보편화
    - 예외는 복구 불가능한 상황에서 발생
    - `CheckedException`이 남발시 무의미한 try catch 구문 강제
  - 다만, `CheckedException`이 항상 나쁜 것은 아님
- 레이어에 맞는 예외 발생
  - DB 관련 예외는 리포지터리 레이어에서 발생
  - 서비스 수준 예외는 서비스 레이어에서 발생
- 예외를 catch 했다면 반드시 로그를 남기고 필요한 조치를 수행
- 로깅
  - 경우에 따라 로깅하지 않는 예외 있을 수 있지만 기본적으로 catch 하면서 로깅
  - stack trace 함께 남길 것
  - 예외에 따라 로깅 레벨을 적절하게 분리
    - debug: 로컬, 개발서버, 프로세스의 처리 순서/흐름을 분석하는데 도움
    - info: 운영, 디버깅 정보 외에 프로세스 설정/기동에 관련한 정보 등
    - warn: 지금 당장은 안 봐도 됨, 오류 상황은 아니지만 추후 확인이 필요한 정보 등
    - error: 지금 당장 확인해야 함



## Q & A

- 사용하는 자바 버전?

  - 11위주로 사용
    - 정작 11 기능을 안 쓰고 있기는 함
  - 팀에서 코틀린을 많이 쓰고 있음

- `Object.hash()` 성능 떨어지지 않나?

  - 성능에 크게 신경쓰지 말자
  - `Optional` 쓰면 성능 떨어진다, 등 얘기도 있던데
  - CPU-Bound 작업 레벨에서 성능을 고려할 시대는 아니다.
  - IO-Bound 작업에서 성능만 신경쓰면 되는 시대가 되었다.

- 코틀린이 대세인데, 자바 공부를 깊게 하는 것이 도움이 될런지?

  - 어차피 지금 코틀린 쓰는 사람들도 자바 썼다.
  - 소통 차원에서도 자바에 대한 이해 중요

- 엔티티 생성자에서 검증 통과하지 않을 경우 어떤 응답을 해줄까?

  - `IllegalArgumentException`이 가장 일반적
  - HTTP 코드로 본다면 400

- 면접관으로 스프링 시큐리티 질문을 한다면?

  - Spring Security Internal 부분을 질문할 듯.
  - 실제로는 관련 내용이 자소서에 없다면 물어보지 않음
  - 질문에 대답한다면 플러스가 된다, 정도일듯

- mutator 메서드 네이밍

  - set? update? change?
  - 정답이 없는 문제

- 로그를 통해 문제를 어떻게 추적할 수 있을까?

  - 사용자 값을 남김

- Service간 참조?

  - 순환참조의 위험이 있기에 이상적으로는 지양하기는 해야함
  - 현실적으로는 어쩔 수 없이 서로 참조할 때가 있음
  - 전체 일정을 해치지 않는 선에서...

- 면접에서 CS의 비중?

  - 신입 채용에서는 비중이 높음
  - 오히려 프레임워크에 대한 지식은 크게 기대하지 않음
  - CS 지식이라면, 자료구조, 웹, 네트워크 등...
    - 제 경우 자료구조의 경우에도 원론적인 차원에서의 질문을 위주로 함
  - 알고리즘의 경우 깊게 물어보지는 않음

  - 면접에서의 CS는 최소치에 대한 물음

- 생성자와 생성 메서드 중 선택 기준
  - 정답이 있는 문제는 아님
  - 팀 합의가 중요
- Custom Exception을 검사 예외로 구현하는 경우도 있는지?
  - 거의 없음, 가능성이 있기야 함
  - 하지만 스프링 MVC 사용한다면 컨트롤러 Advice로 후처리 하기 때문에 굳이?
- 과제 테스트 시에 테스트코드
  - 테스트코드를 보는 경우 명시함
  - 명시 하지 않는 경우도 있지만 그렇다고 테스트코드가 있는지를 보지 않지는 않음
  - 테스트코드가 핵심 로직을 잘 테스트하고 있는지, 아니면 테스트를 위한 테스트인지도 중요
- 완전히 새로운 도메인으로의 이직
  - 특별히 상관 없음
  - 도메인 지식도 중요하지만
  - 그보다 중요한 서비스를 설계, 확장할 수 있는 능력이 중요
- 진로에서, 원하는 도메인 vs 원하는 기업
  - 신입의 경우에는 무조건 도메인 보다는 기업이 중요함